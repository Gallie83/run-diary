<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * * * The content below * * * * * * * * * * * -->
<!-- * * * * * * * * * * is only a placeholder * * * * * * * * * * -->
<!-- * * * * * * * * * * and can be replaced.  * * * * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * Delete the template below * * * * * * * * * -->
<!-- * * * * * * * to get started with your project! * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->


<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<main class="main">
  <div class="content" *ngIf="!newUser">
    <div>
      <mat-card appearance="outlined">
        <mat-card-content>
          <div class="container">
            
            <div class="left-align">

              <mat-tab-group class="user-info-component component">
                <mat-tab label="User Info">
                  <div>Name: {{ this.user.username}}</div>
                  <button mat-button (click)="changeUsername()">Change Username</button>
                  <div>Home location: {{ this.user.startingLocation.placeName}}</div>
                  <button mat-button (click)="changeLocation()">Change Home location</button>
                  <div>
                    <mat-slide-toggle (click)="convertDistance()">
                      {{ this.kilometers ? 'Km' : 'Mi'}}
                    </mat-slide-toggle>
                  </div>
                </mat-tab>
              </mat-tab-group>
            
              <mat-tab-group class="running-stats-component component">

                <mat-tab label="Run Stats">
                  <div>Runs total: {{ this.runningStats.numberOfRuns }}</div>
                  <div>
                    Total Distance: {{ getDisplayDistance(this.runningStats.totalDistanceRan) }}
                  </div>
                </mat-tab>

                <mat-tab label="Add a Goal">
                  <div class="content">
                    <div class="content">
                      <div>Next Goal Location</div>
                      <input
                      placeholder="Search for your first goal address"
                      [(ngModel)]=locationSearch
                      required
                      />
                      <button (click)="generateLocationList()">enter location</button>
                    </div>
                    <div class="location-cards">
                      <!-- If no results for locationSearch -->
                      <div *ngIf="this.noResultsFound">No Results found please try again</div>
                        <!-- Displays locationSearch results -->
                        <div *ngFor="let item of apiResponse">
                          <app-address-card 
                          [addressDetails]="item"
                          (click)="setGoal(item)">
                        </app-address-card>
                      </div>
                    </div>
                  </div> 
                </mat-tab>

                <mat-tab label="Log a Run">
                  <div class="content">
                    <div>How far did you run?</div>
                    <input
                      type="number"
                      min="0.5"
                      value="{{this.distanceRan}}"
                      placeholder="Run Distance"
                      required
                      [(ngModel)]="distanceRan"
                    />
                    <mat-icon (click)="convertDistance()">swap_horizontal_circle</mat-icon>
                    <button (click)="logRun(distanceRan)">Log in {{ this.kilometers ? 'Kilometers' : 'Miles'}}</button>
                  </div>
                </mat-tab>


              </mat-tab-group>
            
          </div>

          <!-- Goal cards -->
          <mat-tab-group class="goals-component component" animationDuration="2000ms" class="goals-tabs">
            
            <mat-tab label="Active Goals"> 
              
              <div *ngIf="user.goals.length">
                
                <div class="goal-div" *ngFor="let goal of user.goals">
                  <ng-container *ngIf="goal.completed == false">
                    <mat-card appearance="outlined">
                      <mat-card-content>
                        <!-- Goal information -->
                        <div class="goal-info">
                          <div>Goal: {{goal.placeName}}</div>
                          <!-- Delete goal button -->
                          <button mat-icon-button (click)="deleteGoal(goal)" class="delete-button" aria-label="Delete">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </div>
                        <div class="goal-info">
                          <div>Distance: {{getDisplayDistance(goal.distance)}}</div>
                          <div class="align-right">{{goal.progress ? goal.progress : 0 }}%</div>
                        </div>
                        <!-- Progress bar -->
                        <mat-progress-bar mode="determinate" value="{{ goal.progress }}"></mat-progress-bar>
                      </mat-card-content>
                    </mat-card>
                    <!-- Appears if goal is completed -->
                    <div (click)="setGoalCompleted(goal)" class="completed" *ngIf="goal.progress === 100">GOAL COMPLETED!</div>
                  </ng-container>
                </div>
                
                <mat-tab label="Completed Goals"> 
                  <div class="goal-div" *ngFor="let goal of user.goals">
                    <ng-container *ngIf="goal.completed == true">
                      <mat-card appearance="outlined">
                        <mat-card-content>
                          <div>Destination: {{goal.placeName}}</div>
                          <div class="goal-info">
                            <div>Distance Ran: {{getDisplayDistance(goal.distance)}}</div>
                          </div>
                        </mat-card-content>
                      </mat-card>
                    </ng-container>
                  </div>  
                </mat-tab>
                
              </div>
              
              <div class="no-goals" *ngIf="user.goals.length === 0">No Goals added</div>
              
            </mat-tab>
          </mat-tab-group>
    
        </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <div class="content" *ngIf="newUser">
    <mat-card class="opening-form-card" appearance="outlined">
      <mat-card-content>
        
        <div class="form-container">
          <div class="input-group">
            <div class="input-label">Username</div>
            <input
              (change)="setUsername()"
              placeholder="some guy"
              [(ngModel)]="username"
              required
            />
          </div>
          
          <div class="input-group">
            <div class="input-label">Starting Location</div>
            <input
              placeholder="Search for your home address"
              [(ngModel)]="locationSearch"
              required
            />
          </div>
          
          <button (click)="generateLocationList()">enter location</button>
        </div>
    
        
        <!-- Displays locationSearch results -->
        <div *ngIf="locationDiv" class="scroll-container">
          <!-- If no results for locationSearch -->
          <div *ngIf="this.noResultsFound">No Results found please try again</div>
          
          <app-address-card 
            *ngFor="let item of apiResponse;"
            class="scrollable-card"
            [addressDetails]="item"
            (click)="setLocation(item)"
            [ngClass]="{'highlight': selectedAddress === item}">
          </app-address-card>

        </div>

        <!-- Submits Form -->
        <button class="button-container" (click)="saveForm()" [disabled]="saveDisabled">Save Form</button>

      </mat-card-content>
    </mat-card>
  </div>
</main>


<router-outlet />
